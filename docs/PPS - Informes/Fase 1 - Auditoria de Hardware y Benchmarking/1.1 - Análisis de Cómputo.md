## <font color="#de7802">1. Objetivo</font>

Estudio de los T[FLOPS](../../Hardware%20-%20Fundamentos%20&%20Definiciones/FLOPS.md) y [Ancho de Banda de Memoria](../../Hardware%20-%20Fundamentos%20&%20Definiciones/Ancho%20de%20Banda%20de%20Memoria.md) en [Token](../../Machine%20Learning%20-%20Fundamentos%20&%20Definiciones/Token.md)/segundo de la [Radxa Rock 5 Model B](../../Radxa%20-%20Conceptos%20&%20SBC/Radxa%20Rock%205%20Model%20B.md) (NPU/GPU) y [NVIDIA Jetson Orin Nano](../../NVIDIA%20-%20Conceptos%20&%20SBC/NVIDIA%20Jetson%20Orin%20Nano.md).

---

## <font color="#de7802">2. Análisis de Cómputo de la Radxa Rock 5 Model B</font>

Para analizar el rendimiento de la Radxa Rock 5 Model B de 16GB de RAM, estudiamos el SoC (*System on Chip*) **RockChip RK3588**. Este procesador cuenta con una arquitectura de 8 núcleos y 64 bits diseñada para aplicaciones de IA y computación avanzada. Integra cuatro núcleos Cortex-A76 (Performance) y cuatro Cortex-A55 (Efficiency); una NPU de **6.0 TOPS** dedicada; y una GPU ARM Mali-G610 MC4. El sistema se apoya en 16GB de RAM LPDDR4x.

### <font color="#fbd5b5">2.1 Especificaciones y Benchmark del CPU RK3588</font>

Utilizamos la librería [cpufp](https://github.com/pigirons/cpufp) para medir los FLOPS pico teóricos mediante [Instrucciones Vectoriales](../../Hardware%20-%20Fundamentos%20&%20Definiciones/Instrucciones%20Vectoriales.md) (NEON). El benchmark permite contrastar el rendimiento entre los clusters de núcleos:

| Métrica | Valor 4x Cores A55 | Valor 4x Cores A76 | Relevancia |
| :--- | :--- | :--- | :--- |
| FP16 Performance | 116,54 GFLOPS | 300,97 GFLOPS | Precisión base de LLMs modernos. |
| **INT8 Performance** | **233,08 GOPS** | **602,22 GOPS** | **Precisión de modelos cuantizados.** |
| FP32 Performance | 58,26 GFLOPS | 150,15 GFLOPS | Aplicaciones de propósito general. |

**Conclusión del CPU:** Los núcleos Cortex-A76 son ~2.6x más rápidos que los A55. Es crítico forzar la afinidad de procesos de inferencia a los núcleos 4-7. Además, el rendimiento en **INT8** duplica al de FP16, validando que la [Cuantización](../../Hardware%20-%20Fundamentos%20&%20Definiciones/Cuantización.md) es indispensable para no desperdiciar el 50% del silicio.

### <font color="#fbd5b5">2.2 Especificaciones y Benchmark del NPU RK3588</font>

La NPU es un acelerador de dominio específico (DSA) optimizado para operaciones tensoriales.

**A. Arquitectura y Capacidad Teórica (6 TOPS)**
Consta de **tres núcleos independientes**, cada uno capaz de entregar 2.0 TOPS, sumando **6.0 TOPS** en INT8. Utiliza operaciones MAC (*Multiply-Accumulate*) masivas por ciclo:
$$\text{TOPS} = \text{(Operaciones MAC)} \times \text{Frecuencia(GHz)} \times 2$$

**B. Ecosistema de Software: RKNN y RKLLM**
Para el despliegue, Rockchip provee el stack [RKNN-Toolkit2](https://github.com/rockchip-linux/rknn-toolkit2). Para nuestro caso de uso, utilizaremos [RKLLM](https://github.com/airockchip/rknn-llm), específicamente diseñado para optimizar modelos de lenguaje. RKLLM permite el uso de cuantizaciones **w4a16** (pesos en 4 bits y activaciones en 16 bits), lo cual es ideal para equilibrar velocidad y precisión.

**C. Comparativa de Rendimiento (Latencia)**
La NPU demuestra una superioridad exponencial frente a la CPU:

| Modelo (Benchmark) | Latencia CPU (8 núcleos) | Latencia NPU (RK3588) | Mejora (Speedup) |
| :--- | :--- | :--- | :--- |
| MobileNet V2 | ~45,2 ms | **~1,2 ms** | ~37x |
| YOLO V5 s | ~320 ms | **~14,5 ms** | ~22x |

**D. Dinámica NPU-RAM: Orquestación del Flujo**
La NPU utiliza un controlador **DMA** (*Direct Memory Access*) para no saturar la CPU:
1. **Carga:** Los pesos (INT8/INT4) viajan de la RAM a la caché local de la NPU.
2. **Cómputo:** Los núcleos ejecutan las matrices de atención en paralelo.
3. **Escritura:** Los *logits* resultantes vuelven a la RAM para el post-procesamiento (Softmax) en CPU.

### <font color="#fbd5b5">2.3 Cálculo del Ancho de Banda de Memoria y Rendimiento Real</font>

El rendimiento en tokens/s está dictado por el **Memory Wall**. El bus del RK3588 es de **64 bits** (4 canales x 16 bits) a 2112 MHz:

$$BW = \frac{2112 \text{ MHz} \times 2 \times 64 \text{ bits}}{8 \times 1000} = \mathbf{33,79 \text{ GB/s}}$$

**Estimación para Qwen 2.5 7B:**
Si utilizamos una cuantización **INT4** nos queda que cada parámetro ocupa aproximadamente 0,7 bytes de parámetros (~4,8 GB de peso), el cálculo teórico de generación es:
$$\text{Tokens/s} = \frac{\text{Ancho de Banda de Memoria (GB/s)}}{\text{Peso del Modelo (GB)}}$$
$$\text{Tokens/s} = \frac{33,8 \text{ GB/s}}{4,8 \text{ GB}} \approx \mathbf{7,04 \text{ tok/s}}$$
Sin embargo, por cuestiones fisicas de nuestro hardware como [Latencia](../../Hardware%20-%20Fundamentos%20&%20Definiciones/Latencia.md) de bus, ciclos de refresco de RAM y carga del OS normalmente en una SBC como la Rock 5 la eficiencia se encuentra dentro del 70%-80%. Por lo tanto:
$$7.04 \text{ tok/s} \times 0.75 \approx \mathbf{5.2 \text{ - } 5.5 \text{ tok/s}}$$
### <font color="#fbd5b5">2.4 Consideraciones sobre el Hardware de Prueba</font>

Es importante notar que los benchmarks oficiales de Rockchip (RKLLM) se realizan en entornos controlados (EVB). Sin embargo, la **Radxa Rock 5 Model B** de 16GB presenta ventajas competitivas frente a otras implementaciones del RK3588:

* **Gestión Térmica:** Al ser una placa de formato mayor, permite disipadores de calor más robustos, evitando el *Thermal Throttling* que reduciría las frecuencias de la NPU durante sesiones largas de tutoría.
* **Capacidad de RAM:** Los 16GB de LPDDR4x permiten alojar no solo el modelo cuantizado, sino también el stack de software completo (Sistema Operativo, Text-to-Speech y la lógica del tutor) sin recurrir al intercambio en disco (*swap*), lo que preserva la integridad de la latencia medida.
* **Bus de Datos:** A diferencia de SoCs inferiores de la misma familia (como el RK3562), la Rock 5B aprovecha los 4 canales de 16 bits, garantizando que el cuello de botella sea el límite físico de la tecnología LPDDR4x y no una restricción de diseño de la placa.

---

## <font color="#de7802">3. Conclusiones de la Fase de Cómputo de Rock 5 Model B</font>

2. **Limitación por Memoria (Memory Bound):** A pesar de contar con 6 TOPS en la NPU y más de 600 GOPS en la CPU, el sistema nunca alcanzará su pico de cómputo teórico en LLMs. La velocidad está limitada por los 33,8 GB/s de la RAM.
3. **Superioridad de la NPU:** Aunque la tasa de tokens/s de salida esté limitada por la RAM, el uso de la NPU es vital para reducir la latencia de entrada (**TTFT** - *Time To First Token*) y liberar la CPU para tareas lógicas y de gestión del sistema operativo.
4. **Eficiencia de Cuantización:** El uso de formatos **INT4** es obligatorio. No solo reduce el consumo de memoria, sino que es el único modo de acercar la experiencia del Tutor a una velocidad de lectura humana (~5-7 tok/s).
5. **Desbalance Tecnológico:** La arquitectura del RK3588 presenta un desbalance entre su alta capacidad de cómputo y su ancho de banda de memoria. Esto confirma que, para aplicaciones de [Edge AI](../../Machine%20Learning%20-%20Fundamentos%20&%20Definiciones/Edge%20AI.md), la métrica de éxito no son los TOPS, sino la eficiencia del bus de datos.